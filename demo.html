<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ™ºèƒ½è¯¾ç¨‹è§„åˆ’ä¸å­¦ä¸šè¾…åŠ©ç³»ç»Ÿ - çº¯å‰ç«¯æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
            color: white;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .mode-selector {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #f0f0f0;
        }

        .card h2 {
            color: #1890ff;
            margin-bottom: 16px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 0 4px;
            transition: all 0.3s ease;
        }

        .button.primary {
            background: #1890ff;
            color: white;
        }

        .button.secondary {
            background: #52c41a;
            color: white;
        }

        .button.disabled {
            background: #f5f5f5;
            color: #ccc;
            cursor: not-allowed;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #1890ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .recommendation-item {
            padding: 16px;
            border: 1px solid #e6f7ff;
            border-radius: 8px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #f6ffed 0%, #ffffff 100%);
        }

        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .recommendation-title {
            font-weight: bold;
            color: #1890ff;
            font-size: 1.1rem;
        }

        .score-badge {
            background: #1890ff;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .reasons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .reason-tag {
            background: #e6f7ff;
            color: #1890ff;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .plan-item {
            margin-bottom: 24px;
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .plan-title {
            font-weight: bold;
            color: #52c41a;
        }

        .goal-badge {
            background: #52c41a;
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: #52c41a;
            transition: width 0.3s ease;
        }

        .semester-item {
            padding: 16px;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
            margin-bottom: 12px;
            background: #fafafa;
        }

        .semester-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .semester-title {
            font-weight: bold;
            color: #52c41a;
        }

        .status-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
        }

        .status-active {
            background: #1890ff;
        }

        .status-planned {
            background: #d9d9d9;
        }

        .course-tag {
            display: inline-block;
            background: #fff1f0;
            color: #f5222d;
            padding: 2px 6px;
            border-radius: 4px;
            margin: 2px 4px 2px 0;
            font-size: 12px;
        }

        .course-high {
            background: #fff1f0;
            color: #f5222d;
        }

        .course-medium {
            background: #f6ffed;
            color: #52c41a;
        }

        .chat-container {
            border: 1px solid #f0f0f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            max-height: 300px;
            overflow-y: auto;
            background: #fafafa;
        }

        .message {
            margin-bottom: 12px;
            display: flex;
            justify-content: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .message.user .message-content {
            background: #1890ff;
            color: white;
        }

        .message.assistant .message-content {
            background: white;
            color: #333;
            border: 1px solid #f0f0f0;
        }

        .message-header {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .message-time {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 4px;
        }

        .input-group {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            min-height: 60px;
            padding: 12px;
            border: 1px solid #d9d9d9;
            border-radius: 8px;
            resize: vertical;
            font-size: 14px;
            font-family: inherit;
        }

        .quick-questions {
            margin-top: 16px;
        }

        .quick-questions h4 {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .question-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .question-tag {
            background: #f0f0f0;
            color: #666;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .question-tag:hover {
            background: #e6f7ff;
            color: #1890ff;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: white;
            opacity: 0.8;
        }

        .api-url-input {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
            font-size: 14px;
            margin-left: 8px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ¤– AIæ™ºèƒ½è¯¾ç¨‹è§„åˆ’ä¸å­¦ä¸šè¾…åŠ©ç³»ç»Ÿ</h1>
            <p>ä¸€é”®ä½“éªŒAIæ¨èã€å­¦ä¸šè§„åˆ’ã€æ™ºèƒ½å¯¹è¯ - çº¯å‰ç«¯å®ç°ï¼Œæ— éœ€æœåŠ¡å™¨</p>

            <div class="mode-selector">
                <div style="margin-bottom: 12px;">
                    <strong>å·¥ä½œæ¨¡å¼ï¼š</strong>
                    <button class="button secondary" id="mockBtn">ğŸ”„ æœ¬åœ°æ¨¡æ‹Ÿ</button>
                    <button class="button" id="apiBtn">ğŸŒ APIè”ç½‘</button>
                </div>

                <div id="apiConfig" class="hidden">
                    <label><strong>APIåœ°å€ï¼š</strong></label>
                    <input type="url" class="api-url-input" id="apiUrlInput" value="https://your.api.url/api" placeholder="https://your-api.com/api">
                </div>
            </div>
        </header>

        <main>
            <!-- AIè¯¾ç¨‹æ¨è -->
            <section class="card">
                <h2>ğŸ¯ æ™ºèƒ½è¯¾ç¨‹æ¨è</h2>
                <div style="margin-bottom: 20px;">
                    <button class="button primary" id="recommendBtn">
                        <span id="recommendLoading" class="loading hidden"></span>
                        ğŸš€ ç”ŸæˆAIæ¨è
                    </button>
                </div>

                <div id="recommendationsContainer">
                    <!-- æ¨èç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </section>

            <!-- AIå­¦ä¸šè§„åˆ’ -->
            <section class="card">
                <h2>ğŸ“… AIå­¦ä¸šè§„åˆ’</h2>
                <div style="margin-bottom: 20px;">
                    <button class="button primary" id="planBtn">
                        <span id="planLoading" class="loading hidden"></span>
                        ğŸ“‹ ç”Ÿæˆå­¦ä¹ è§„åˆ’
                    </button>
                </div>

                <div id="plansContainer">
                    <!-- è§„åˆ’ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </section>

            <!-- AIå¯¹è¯åŠ©æ‰‹ -->
            <section class="card">
                <h2>ğŸ’¬ AIå¯¹è¯åŠ©æ‰‹</h2>
                <p style="color: #666; margin-bottom: 20px;">éšæ—¶æé—®ï¼Œè·å¾—ä¸“ä¸šå­¦ä¹ æŒ‡å¯¼å’Œå»ºè®®</p>

                <!-- å¯¹è¯å†å² -->
                <div class="chat-container" id="chatContainer">
                    <div class="message assistant">
                        <div class="message-content">
                            <div class="message-header">ğŸ¤– AIåŠ©æ‰‹</div>
                            <div>ä½ å¥½ï¼æˆ‘æ˜¯AIå­¦ä¹ åŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ è§£ç­”å­¦ä¹ é—®é¢˜ã€æ¨èè¯¾ç¨‹ã€åˆ¶å®šå­¦ä¹ è®¡åˆ’ã€‚è¯•è¯•è¾“å…¥ï¼šå‰ç«¯å¼€å‘éœ€è¦å­¦ä»€ä¹ˆï¼Ÿ</div>
                            <div class="message-time">12:00:00</div>
                        </div>
                    </div>
                </div>

                <!-- è¾“å…¥æ¡† -->
                <form class="input-group" id="chatForm">
                    <textarea
                        class="input-field"
                        id="chatInput"
                        placeholder="è¾“å…¥ä½ çš„å­¦ä¹ é—®é¢˜ï¼Œæ¯”å¦‚ï¼š'å‰ç«¯å¼€å‘éœ€è¦å­¦ä»€ä¹ˆï¼Ÿ' æˆ– 'å¦‚ä½•åˆ¶å®šå­¦ä¹ è®¡åˆ’ï¼Ÿ'"
                        rows="2"
                    ></textarea>
                    <button type="submit" class="button primary" id="sendBtn">
                        ğŸ“¤ å‘é€
                    </button>
                </form>

                <!-- å¿«æ·é—®é¢˜ -->
                <div class="quick-questions">
                    <h4>ğŸ’¡ è¯•è¯•è¿™äº›é—®é¢˜ï¼š</h4>
                    <div class="question-tags">
                        <span class="question-tag" data-question="å‰ç«¯å¼€å‘éœ€è¦å­¦ä»€ä¹ˆï¼Ÿ">å‰ç«¯å¼€å‘éœ€è¦å­¦ä»€ä¹ˆï¼Ÿ</span>
                        <span class="question-tag" data-question="å¦‚ä½•åˆ¶å®šå­¦ä¹ è®¡åˆ’ï¼Ÿ">å¦‚ä½•åˆ¶å®šå­¦ä¹ è®¡åˆ’ï¼Ÿ</span>
                        <span class="question-tag" data-question="è€ƒç ”éœ€è¦å‡†å¤‡å“ªäº›ç§‘ç›®ï¼Ÿ">è€ƒç ”éœ€è¦å‡†å¤‡å“ªäº›ç§‘ç›®ï¼Ÿ</span>
                        <span class="question-tag" data-question="æ—¶é—´ç®¡ç†æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ">æ—¶é—´ç®¡ç†æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ</span>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>ğŸ“ æ²³åŒ—å·¥ä¸šèŒä¸šæŠ€æœ¯å¤§å­¦äº’è”ç½‘å­¦é™¢</p>
            <p style="font-size: 14px;">AIæ™ºèƒ½è¯¾ç¨‹è§„åˆ’ä¸å­¦ä¸šè¾…åŠ©ç³»ç»Ÿ - çº¯å‰ç«¯å®ç°</p>
        </footer>
    </div>

    <script>
        // çŠ¶æ€ç®¡ç†
        let state = {
            mode: 'mock', // 'mock' | 'api'
            apiUrl: 'https://your.api.url/api',
            recommendations: [],
            plans: [],
            chatMessages: [{
                role: 'assistant',
                content: 'ä½ å¥½ï¼æˆ‘æ˜¯AIå­¦ä¹ åŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ è§£ç­”å­¦ä¹ é—®é¢˜ã€æ¨èè¯¾ç¨‹ã€åˆ¶å®šå­¦ä¹ è®¡åˆ’ã€‚è¯•è¯•è¾“å…¥ï¼šå‰ç«¯å¼€å‘éœ€è¦å­¦ä»€ä¹ˆï¼Ÿ',
                timestamp: new Date().toLocaleTimeString()
            }],
            loading: false
        };

        // DOM å…ƒç´ å¼•ç”¨
        const mockBtn = document.getElementById('mockBtn');
        const apiBtn = document.getElementById('apiBtn');
        const apiConfig = document.getElementById('apiConfig');
        const apiUrlInput = document.getElementById('apiUrlInput');
        const recommendBtn = document.getElementById('recommendBtn');
        const recommendLoading = document.getElementById('recommendLoading');
        const recommendationsContainer = document.getElementById('recommendationsContainer');
        const planBtn = document.getElementById('planBtn');
        const planLoading = document.getElementById('planLoading');
        const plansContainer = document.getElementById('plansContainer');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatContainer = document.getElementById('chatContainer');

        // æ¨¡æ‹Ÿæ•°æ®
        const mockRecommendations = [
            {
                courseName: 'Reactå…¨æ ˆå¼€å‘',
                courseCode: 'CS401',
                credits: 3,
                score: 95,
                reasons: ['å®Œç¾åŒ¹é…å‰ç«¯å¼€å‘å…´è¶£', 'å¸‚åœºéœ€æ±‚å¤§', 'æŠ€æœ¯æ ˆç°ä»£']
            },
            {
                courseName: 'äººå·¥æ™ºèƒ½å¯¼è®º',
                courseCode: 'AI101',
                credits: 3,
                score: 88,
                reasons: ['AIæŠ€èƒ½æ˜¯æœªæ¥è¶‹åŠ¿', 'ä¸ä¸“ä¸šç»“åˆæ€§å¥½']
            },
            {
                courseName: 'æ•°æ®åº“ç³»ç»Ÿ',
                courseCode: 'CS301',
                credits: 3,
                score: 85,
                reasons: ['è®¡ç®—æœºä¸“ä¸šå¿…ä¿®', 'å®è·µæ€§å¼º', 'å°±ä¸šå¸®åŠ©å¤§']
            }
        ];

        const mockPlan = {
            title: 'å‰ç«¯å¼€å‘å­¦ä¹ è§„åˆ’',
            goal: 'å°±ä¸š',
            progress: 25,
            totalCredits: 12,
            completedCredits: 3,
            semesters: [
                {
                    semester: '2024-ç§‹å­£',
                    status: 'è¿›è¡Œä¸­',
                    courses: [
                        { courseId: 'web101', courseName: 'Webå¼€å‘åŸºç¡€', priority: 'é«˜' },
                        { courseId: 'cs201', courseName: 'æ•°æ®ç»“æ„', priority: 'é«˜' },
                        { courseId: 'ui101', courseName: 'ç”¨æˆ·ç•Œé¢è®¾è®¡', priority: 'ä¸­' }
                    ]
                },
                {
                    semester: '2025-æ˜¥å­£',
                    status: 'è§„åˆ’ä¸­',
                    courses: [
                        { courseId: 'react101', courseName: 'Reactæ¡†æ¶', priority: 'é«˜' },
                        { courseId: 'node101', courseName: 'Node.jsåç«¯å¼€å‘', priority: 'é«˜' }
                    ]
                }
            ]
        };

        const mockChatResponses = [
            'è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼å‰ç«¯å¼€å‘éœ€è¦æŒæ¡HTMLã€CSSã€JavaScriptç­‰åŸºç¡€çŸ¥è¯†ï¼Œè¿˜éœ€è¦å­¦ä¹ Reactã€Vueç­‰æ¡†æ¶æŠ€æœ¯ã€‚å»ºè®®æŒ‰ç…§"åŸºç¡€â†’æ¡†æ¶â†’å·¥å…·â†’é¡¹ç›®"çš„é¡ºåºå­¦ä¹ ã€‚',
            'å…³äºå­¦ä¸šè§„åˆ’ï¼Œæˆ‘å»ºè®®ä½ åˆ¶å®šä¸€ä¸ªé˜¶æ®µæ€§çš„å­¦ä¹ è®¡åˆ’ï¼šçŸ­æœŸç›®æ ‡ï¼ˆè¿™å­¦æœŸï¼‰ã€ä¸­æœŸç›®æ ‡ï¼ˆè¿™ä¸ªå­¦å¹´ï¼‰ã€é•¿æœŸç›®æ ‡ï¼ˆæ¯•ä¸šåï¼‰ã€‚åŒæ—¶è¦æ³¨æ„å¹³è¡¡ä¸“ä¸šè¯¾å’Œå…´è¶£åŸ¹å…»ã€‚',
            'å¯¹äºè¯¾ç¨‹é€‰æ‹©ï¼Œæˆ‘æ¨èä½ ä¼˜å…ˆé€‰æ‹©ä¸èŒä¸šå‘å±•ç›¸å…³çš„ä¸“ä¸šè¯¾ç¨‹ï¼ŒåŒæ—¶é€‚å½“é€‰ä¿®ä¸€äº›é€šè¯†è¯¾ç¨‹æ¥æ‹“å®½çŸ¥è¯†é¢ã€‚å¯ä»¥é€šè¿‡å­¦æ ¡é€‰è¯¾ç³»ç»Ÿäº†è§£è¯¾ç¨‹è¯„ä»·å’Œéš¾åº¦ã€‚',
            'å­¦ä¹ æ–¹æ³•ä¸Šï¼Œå»ºè®®é‡‡ç”¨"é¢„ä¹ -å¬è¯¾-å¤ä¹ -å®è·µ"çš„æ¨¡å¼ã€‚é¢„ä¹ å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£è¯¾å ‚å†…å®¹ï¼Œå®è·µåˆ™æ˜¯æ£€éªŒå­¦ä¹ æ•ˆæœçš„é‡è¦æ–¹å¼ã€‚',
            'å…³äºæ—¶é—´ç®¡ç†ï¼Œå¯ä»¥å°è¯•"ç•ªèŒ„å·¥ä½œæ³•"ï¼š25åˆ†é’Ÿä¸“æ³¨å­¦ä¹ +5åˆ†é’Ÿä¼‘æ¯ï¼Œ4ä¸ªç•ªèŒ„é’Ÿåè¿›è¡Œè¾ƒé•¿ä¼‘æ¯ã€‚è¿™æ ·å¯ä»¥æé«˜å­¦ä¹ æ•ˆç‡ã€‚'
        ];

        // å·¥å…·å‡½æ•°
        function setLoading(button, loadingSpan, isLoading) {
            if (isLoading) {
                button.disabled = true;
                loadingSpan.classList.remove('hidden');
                button.innerHTML = button.innerHTML.replace('ğŸš€ ç”ŸæˆAIæ¨è', 'ğŸ”„ AIåˆ†æä¸­...').replace('ğŸ“‹ ç”Ÿæˆå­¦ä¹ è§„åˆ’', 'ğŸ”„ AIè§„åˆ’ä¸­...');
            } else {
                button.disabled = false;
                loadingSpan.classList.add('hidden');
                button.innerHTML = button.innerHTML.replace('ğŸ”„ AIåˆ†æä¸­...', 'ğŸš€ ç”ŸæˆAIæ¨è').replace('ğŸ”„ AIè§„åˆ’ä¸­...', 'ğŸ“‹ ç”Ÿæˆå­¦ä¹ è§„åˆ’');
            }
        }

        function getMockChatResponse(question) {
            return mockChatResponses[Math.floor(Math.random() * mockChatResponses.length)];
        }

        // APIè¯·æ±‚å‡½æ•°
        async function makeApiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(state.apiUrl + endpoint, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data.success ? data.data : null;
            } catch (error) {
                console.error('API request failed:', error);
                return null;
            }
        }

        // æ¸²æŸ“å‡½æ•°
        function renderRecommendations() {
            if (state.recommendations.length === 0) {
                recommendationsContainer.innerHTML = '';
                return;
            }

            recommendationsContainer.innerHTML = `
                <h3 style="color: #666; margin-bottom: 16px;">ğŸ“š æ¨èç»“æœ</h3>
                <div style="display: grid; gap: 12px;">
                    ${state.recommendations.map(item => `
                        <div class="recommendation-item">
                            <div class="recommendation-header">
                                <div class="recommendation-title">${item.courseName}</div>
                                <div class="score-badge">${item.score}åˆ†</div>
                            </div>

                            ${item.courseCode || item.credits ? `
                                <div style="font-size: 14px; color: #666; margin-bottom: 8px;">
                                    ${item.courseCode ? `è¯¾ç¨‹ä»£ç : ${item.courseCode}` : ''}
                                    ${item.credits ? `<span style="margin-left: 16px;">å­¦åˆ†: ${item.credits}</span>` : ''}
                                </div>
                            ` : ''}

                            <div style="color: #52c41a; font-weight: bold; margin-bottom: 4px;">ğŸ’¡ æ¨èç†ç”±ï¼š</div>
                            <div class="reasons">
                                ${item.reasons.map(reason => `<span class="reason-tag">${reason}</span>`).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderPlans() {
            if (state.plans.length === 0) {
                plansContainer.innerHTML = '';
                return;
            }

            plansContainer.innerHTML = state.plans.map(plan => `
                <div class="plan-item">
                    <div class="plan-header">
                        <div class="plan-title">${plan.title}</div>
                        <div class="goal-badge">ğŸ¯ ${plan.goal}</div>
                    </div>

                    ${(plan.totalCredits || plan.completedCredits) ? `
                        <div style="margin-bottom: 16px;">
                            <div style="font-size: 14px; color: #666; margin-bottom: 4px;">
                                ğŸ“Š å­¦åˆ†è¿›åº¦: ${plan.completedCredits || 0} / ${plan.totalCredits || 0}
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${plan.progress}%"></div>
                            </div>
                            <div style="text-align: center; font-size: 12px; color: #666; margin-top: 4px;">
                                æ€»ä½“è¿›åº¦: ${plan.progress}%
                            </div>
                        </div>
                    ` : ''}

                    <h4 style="color: #666; margin-bottom: 12px;">ğŸ“š å­¦æœŸå®‰æ’</h4>
                    <div style="display: grid; gap: 12px;">
                        ${plan.semesters.map(sem => `
                            <div class="semester-item">
                                <div class="semester-header">
                                    <div class="semester-title">${sem.semester}</div>
                                    ${sem.status ? `
                                        <span class="status-badge ${sem.status === 'è¿›è¡Œä¸­' ? 'status-active' : 'status-planned'}">
                                            ${sem.status}
                                        </span>
                                    ` : ''}
                                </div>

                                <div style="font-size: 14px; color: #666;">
                                    ${sem.courses.map(course => `
                                        <span class="course-tag ${course.priority === 'é«˜' ? 'course-high' : 'course-medium'}">
                                            ${course.courseName || course.courseId} (${course.priority}ä¼˜å…ˆçº§)
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function renderChatMessages() {
            chatContainer.innerHTML = state.chatMessages.map(msg => `
                <div class="message ${msg.role}">
                    <div class="message-content">
                        <div class="message-header">${msg.role === 'assistant' ? 'ğŸ¤– AIåŠ©æ‰‹' : 'ğŸ‘¤ ä½ '}</div>
                        <div>${msg.content}</div>
                        ${msg.timestamp ? `<div class="message-time">${msg.timestamp}</div>` : ''}
                    </div>
                </div>
            `).join('');

            // æ»šåŠ¨åˆ°åº•éƒ¨
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // äº‹ä»¶å¤„ç†å™¨
        mockBtn.addEventListener('click', () => {
            state.mode = 'mock';
            mockBtn.className = 'button secondary';
            apiBtn.className = 'button';
            apiConfig.classList.add('hidden');
        });

        apiBtn.addEventListener('click', () => {
            state.mode = 'api';
            mockBtn.className = 'button';
            apiBtn.className = 'button secondary';
            apiConfig.classList.remove('hidden');
        });

        apiUrlInput.addEventListener('input', (e) => {
            state.apiUrl = e.target.value;
        });

        recommendBtn.addEventListener('click', async () => {
            setLoading(recommendBtn, recommendLoading, true);

            try {
                if (state.mode === 'api') {
                    const data = await makeApiRequest('/recommendations');
                    state.recommendations = data || [];
                } else {
                    // æ¨¡æ‹Ÿå»¶è¿Ÿ
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    state.recommendations = mockRecommendations;
                }
                renderRecommendations();
            } catch (error) {
                console.error('è·å–æ¨èå¤±è´¥:', error);
                state.recommendations = mockRecommendations;
                renderRecommendations();
            }

            setLoading(recommendBtn, recommendLoading, false);
        });

        planBtn.addEventListener('click', async () => {
            setLoading(planBtn, planLoading, true);

            try {
                if (state.mode === 'api') {
                    const data = await makeApiRequest('/academic-plan');
                    state.plans = data ? [data] : [];
                } else {
                    // æ¨¡æ‹Ÿå»¶è¿Ÿ
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    state.plans = [mockPlan];
                }
                renderPlans();
            } catch (error) {
                console.error('ç”Ÿæˆè§„åˆ’å¤±è´¥:', error);
                state.plans = [mockPlan];
                renderPlans();
            }

            setLoading(planBtn, planLoading, false);
        });

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = chatInput.value.trim();
            if (!message) return;

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            state.chatMessages.push({
                role: 'user',
                content: message,
                timestamp: new Date().toLocaleTimeString()
            });

            chatInput.value = '';
            renderChatMessages();

            // AIå›å¤
            try {
                let aiResponse;
                if (state.mode === 'api') {
                    const data = await makeApiRequest('/chat', {
                        method: 'POST',
                        body: JSON.stringify({ question: message })
                    });
                    aiResponse = data?.answer || 'æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜ã€‚';
                } else {
                    // æ¨¡æ‹Ÿå»¶è¿Ÿ
                    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));
                    aiResponse = getMockChatResponse(message);
                }

                state.chatMessages.push({
                    role: 'assistant',
                    content: aiResponse,
                    timestamp: new Date().toLocaleTimeString()
                });

                renderChatMessages();
            } catch (error) {
                console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
                state.chatMessages.push({
                    role: 'assistant',
                    content: 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åˆ‡æ¢åˆ°æœ¬åœ°æ¨¡æ‹Ÿæ¨¡å¼ã€‚',
                    timestamp: new Date().toLocaleTimeString()
                });
                renderChatMessages();
            }
        });

        // å¿«æ·é—®é¢˜ç‚¹å‡»
        document.querySelectorAll('.question-tag').forEach(tag => {
            tag.addEventListener('click', () => {
                chatInput.value = tag.dataset.question;
                chatInput.focus();
            });
        });

        // åˆå§‹åŒ–
        renderChatMessages();
    </script>
</body>
</html>
